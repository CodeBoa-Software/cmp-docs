# Custos de Infraestrutura Mensal - Entrega 1

**Projeto:** Casa M√£e Paulistana  
**Data:** Outubro 2025  
**Vers√£o:** 1.0

---

## üìä Volume Esperado

### Premissas de Uso
- **3.000 cadastros/m√™s** (volume estimado)
- **4 documentos obrigat√≥rios** por cadastro
- **12.000 uploads/m√™s** total
- **Tamanho m√©dio:** 3MB por arquivo
- **Volume mensal:** ~36GB de documentos

---

## üí∞ Detalhamento de Custos (Google Cloud Platform)

### 1. Cloud Run - Frontend (React)

**Funcionalidade:** Formul√°rio de pr√©-cadastro p√∫blico

```yaml
Configura√ß√£o:
  CPU: 1 vCPU
  RAM: 512MB
  Uptime: 24/7 (link p√∫blico compartilh√°vel)
  
Volume estimado:
  Page views: 100.000/m√™s
  Requests: 100.000/m√™s
  CPU-seconds: ~50.000/m√™s
  Memory-GB-seconds: ~25.000/m√™s

Custo mensal: $15-25
Custo m√©dio: $20/m√™s
```

**Justificativa:** Link p√∫blico precisa estar sempre dispon√≠vel para compartilhamento em redes sociais e WhatsApp. Cold starts s√£o aceit√°veis para formul√°rio p√∫blico.

---

### 2. Cloud Run - Backend (.NET API)

**Funcionalidades:**
- Receber dados do formul√°rio
- Validar uploads (formato, tamanho)
- Processar 12.000 uploads/m√™s
- Integra√ß√£o Google Drive API
- Gerar protocolo de confirma√ß√£o

```yaml
Configura√ß√£o:
  CPU: 1 vCPU
  RAM: 1GB
  Min instances: 1 (evitar cold starts em uploads)
  
Volume estimado:
  Uploads: 12.000/m√™s
  Tempo m√©dio por upload: 2-5s
  CPU-seconds: ~36.000/m√™s
  API calls: ~27.000/m√™s
  
Custo mensal: $30-45
Custo m√©dio: $37/m√™s
```

**Justificativa:** Min instance = 1 garante que uploads sejam processados rapidamente sem espera de cold start. Cr√≠tico para boa experi√™ncia do usu√°rio.

---

### 3. Cloud SQL PostgreSQL

**Dados armazenados:**
- Informa√ß√µes pessoais (respons√°vel + dependente)
- Metadata de documentos (4 por cadastro)
- Prefer√™ncias de agendamento
- Protocolos de confirma√ß√£o
- Audit logs (LGPD)

```yaml
Configura√ß√£o:
  Tipo: db-custom-1-3840 (1 vCPU, 3.75GB RAM)
  Storage: 50GB SSD
  Uptime: 24/7
  Backups autom√°ticos: habilitado
  
Volume estimado:
  Writes: ~15.000/m√™s (cadastros + documentos + logs)
  Reads: ~5.000/m√™s (consultas admin)
  
Schema:
  - beneficiarios: ~3k registros/m√™s
  - documentos: ~12k registros/m√™s
  - audit_logs: ~15k registros/m√™s
  
Custo mensal: $18-25
Custo m√©dio: $20/m√™s
```

**Justificativa:** Cloud SQL oferece performance adequada para o volume inicial e √© mais econ√¥mico. Backups autom√°ticos garantem conformidade LGPD com audit trail completo.

---

### 4. Google Drive API (Storage Prim√°rio)

**Uso:**
- 12.000 uploads/m√™s
- Organiza√ß√£o em pastas estruturadas
- Metadata vinculado ao PostgreSQL

```yaml
API Calls:
  Uploads: 12.000/m√™s
  Folder operations: ~1.000/m√™s
  Metadata reads: ~2.000/m√™s
  Total: ~15.000 calls/m√™s

Quota:
  Limite di√°rio: 1 bilh√£o requests/dia
  Uso estimado: 500 requests/dia
  
Storage:
  Inclu√≠do no Google Workspace do cliente
  
Custo mensal: $0 ‚úÖ
```

**Justificativa:** Cliente j√° possui Google Workspace. Armazenamento prim√°rio no Drive mant√©m documentos acess√≠veis pela equipe sem custo adicional.

---

### 5. Cloud Storage (Backup Autom√°tico)

**Uso:** Backup de seguran√ßa de todos os uploads

```yaml
Armazenamento:
  Standard class: primeiros 30 dias
  Nearline class: ap√≥s 30 dias (lifecycle policy)
  
Volume mensal:
  Novos uploads: 36GB/m√™s
  Ap√≥s 3 meses: 108GB total
  
Custos (por m√™s):
  Storage Standard: 36GB √ó $0.020 = $0.72
  Write operations: 12.000 √ó $0.005/1000 = $0.06
  Read operations: 500 √ó $0.004/1000 = $0.002
  
Com Lifecycle (Nearline ap√≥s 30 dias):
  M√™s 1: 36GB Standard = $0.72
  M√™s 2: 36GB Standard + 36GB Nearline = $0.72 + $0.36 = $1.08
  M√™s 3+: 36GB Standard + 72GB Nearline = $0.72 + $0.72 = $1.44
  
Custo mensal: $0.80-1.50
Custo m√©dio: $1.50/m√™s
```

**Justificativa:** Backup redundante garante recupera√ß√£o em caso de problemas com Google Drive. Lifecycle policy otimiza custos automaticamente.

---

### 6. Cloud Monitoring & Logging

**Monitoramento necess√°rio:**
- Logs de upload (sucesso/erro)
- M√©tricas de performance
- Audit trail (LGPD)
- Alertas de custo

```yaml
Volume:
  Application logs: ~200MB/m√™s
  Access logs: ~100MB/m√™s
  Metrics: basic tier
  Alertas: 5 regras
  
Componentes:
  Logs ingestion: 300MB/m√™s (dentro do free tier: 50GB)
  Metrics: basic (gratuito)
  Alertas: $0.10 cada = $0.50
  
Custo mensal: $5-10
Custo m√©dio: $7/m√™s
```

**Justificativa:** Monitoramento essencial para detectar problemas rapidamente e garantir auditoria LGPD. Volume dentro do free tier mant√©m custos baixos.

---

## üìà Resumo de Custos - Entrega 1

| Componente | Configura√ß√£o | Custo USD/m√™s | Custo BRL/m√™s* |
|-----------|--------------|---------------|----------------|
| **Cloud Run (Frontend)** | 512MB, 1 vCPU, 24/7 | $20 | R$ 112 |
| **Cloud Run (Backend)** | 1GB, 1 vCPU, min-instances: 1 | $37 | R$ 207 |
| **Cloud SQL PostgreSQL** | 1 vCPU, 3.75GB RAM, 50GB | $20 | R$ 112 |
| **Google Drive API** | Workspace cliente | $0 | R$ 0 |
| **Cloud Storage (Backup)** | 36GB/m√™s + lifecycle | $1.50 | R$ 8 |
| **Monitoring & Logging** | Logs + alertas b√°sicos | $7 | R$ 39 |
| **TOTAL MENSAL** | | **$85.50** | **R$ 479** |

*Taxa de c√¢mbio: USD 1 = BRL 5,60 (outubro/2025)

### Custo Unit√°rio
- **R$ 479 √∑ 3.000 cadastros = R$ 0,16 por cadastro** üí∞

---

## üéØ Cen√°rios de Otimiza√ß√£o

### Op√ß√£o 1: Uptime Reduzido (Hor√°rio Comercial)

Se o formul√°rio p√∫blico for acessado principalmente em hor√°rio comercial (220h/m√™s ao inv√©s de 720h/m√™s):

| Componente | Economia | Novo Custo USD | Novo Custo BRL |
|-----------|----------|----------------|----------------|
| Cloud Run (Frontend) | -60% | $8 | R$ 45 |
| Cloud Run (Backend) | -50% | $18 | R$ 101 |
| Cloud SQL | -50% | $10 | R$ 56 |
| Outros | 0% | $8.50 | R$ 48 |
| **TOTAL** | **-51%** | **$44.50** | **R$ 249** |

**Custo por cadastro:** R$ 0,08

**‚ö†Ô∏è Trade-offs:**
- Cold starts de 2-3s na primeira requisi√ß√£o
- Indispon√≠vel fora do hor√°rio comercial
- Impacto na experi√™ncia do usu√°rio

**Recomenda√ß√£o:** N√£o recomendado para Entrega 1. Link p√∫blico deve estar sempre dispon√≠vel para compartilhamento.

---

### Op√ß√£o 2: Inst√¢ncia Menor (db-f1-micro)

Usar inst√¢ncia compartilhada mais econ√¥mica:

```yaml
Cloud SQL PostgreSQL:
  Tipo: db-f1-micro
  CPU: 1 vCPU shared
  RAM: 0.6GB
  Storage: 10GB SSD
  
Custo mensal: $8-12
Economia: -$10/m√™s
```

| Componente | Custo USD | Custo BRL |
|-----------|-----------|-----------|
| Cloud Run (Frontend) 24/7 | $20 | R$ 112 |
| Cloud Run (Backend) min-1 | $37 | R$ 207 |
| **Cloud SQL** (db-f1-micro) | $10 | R$ 56 |
| Google Drive API | $0 | R$ 0 |
| Cloud Storage | $1.50 | R$ 8 |
| Monitoring | $7 | R$ 39 |
| **TOTAL** | **$75.50** | **R$ 423** |

**Custo por cadastro:** R$ 0,14

**‚ö†Ô∏è Trade-offs:**
- CPU compartilhada (performance vari√°vel)
- Menos mem√≥ria (pode impactar queries complexas)
- Armazenamento reduzido

**Recomenda√ß√£o:** Considerar apenas se or√ßamento for muito limitado. A configura√ß√£o padr√£o (1 vCPU dedicado) oferece melhor rela√ß√£o custo-benef√≠cio.

---

## üìä Compara√ß√£o: Estimativa ADR-002 vs Realidade Entrega 1

| Item | ADR-002 (Geral) | Entrega 1 (Real) | Varia√ß√£o |
|------|-----------------|------------------|----------|
| Frontend | $25-40 | $20 | -25% ‚úÖ |
| Backend | $40-70 | $37 | -7% ‚úÖ |
| Database | $120-180 | $20 (Cloud SQL) | -83% ‚úÖ |
| Storage | $0.90 | $1.50 | +67% ‚ö†Ô∏è |
| Monitoring | $20-30 | $7 | -65% ‚úÖ |
| **TOTAL** | $262 | $85.50 | **-67%** ‚úÖ |

### An√°lise

**‚úÖ Economias identificadas:**
- Formul√°rio simples = menos recursos de frontend
- Backend focado = sem features complexas desnecess√°rias
- Monitoramento apenas essencial

**‚ö†Ô∏è Aumento em Storage:**
- ADR-003 foi muito conservador ($0.90)
- Volume real de 36GB/m√™s requer $1.50
- Ainda assim, extremamente barato (R$ 8/m√™s)

---

## ‚ö†Ô∏è Alertas e Monitoramento Recomendados

### Alertas de Custo

```yaml
Alertas de Budget:
  cr√≠tico:
    threshold: $200/m√™s
    action: Notificar equipe + investigar urgente
  
  aten√ß√£o:
    threshold: $150/m√™s
    action: Revisar configura√ß√µes
  
  info:
    schedule: semanal
    action: Relat√≥rio de custos por componente
```

### Alertas de Performance

```yaml
Alertas de SLA:
  upload_latency:
    threshold: > 10 segundos
    action: Verificar Google Drive API + Cloud Run
  
  error_rate:
    threshold: > 5% de uploads falhados
    action: Investigar logs + notificar dev
  
  database_cpu:
    threshold: > 80% uso
    action: Considerar upgrade ou otimiza√ß√£o
  
  storage_quota:
    threshold: > 80% do esperado
    action: Validar n√£o h√° spam/abuso
```

### M√©tricas de Neg√≥cio

```yaml
KPIs a monitorar:
  - Cadastros completados/dia
  - Taxa de abandono do formul√°rio
  - Tempo m√©dio de preenchimento
  - Documentos enviados com sucesso vs falhas
  - Dispositivos mais usados (mobile/desktop)
  - Hor√°rios de pico de acesso
```

---

## üìã Checklist de Controle de Custos

### Antes do Deploy
- [ ] Configurar alertas de billing ($150 e $200)
- [ ] Definir budget mensal no GCP
- [ ] Revisar quotas do Google Drive API
- [ ] Configurar lifecycle policies no Cloud Storage
- [ ] Validar que free tiers est√£o sendo usados
- [ ] Documentar custos esperados por componente

### Primeiras 2 Semanas (Per√≠odo Cr√≠tico)
- [ ] Monitorar custos **di√°rios**
- [ ] Validar volume real de uploads vs estimado
- [ ] Verificar se h√° cold starts impactando UX
- [ ] Ajustar min-instances se necess√°rio
- [ ] Revisar logs de erros (podem aumentar custos)
- [ ] Validar que lifecycle do Storage est√° funcionando

### Mensal (Rotina)
- [ ] Revisar dashboard de custos GCP
- [ ] Analisar picos de uso e sua causa
- [ ] Otimizar queries lentas do DB
- [ ] Limpar dados tempor√°rios/desnecess√°rios
- [ ] Revisar se configura√ß√µes ainda s√£o adequadas
- [ ] Gerar relat√≥rio de custo/cadastro

### Trimestral (Otimiza√ß√£o)
- [ ] Comparar custos reais vs estimados
- [ ] Avaliar upgrade de inst√¢ncia Cloud SQL (se necess√°rio)
- [ ] Revisar pol√≠tica de reten√ß√£o de backups
- [ ] Considerar reserved instances se volume for est√°vel
- [ ] Validar se componentes est√£o dimensionados corretamente

---

## üí° Dicas de Otimiza√ß√£o de Custos

### 1. Cloud Run
```
‚úÖ Usar min-instances apenas no backend (uploads cr√≠ticos)
‚úÖ Frontend pode ter min-instances: 0 (cold start aceit√°vel)
‚úÖ Configurar max-instances para evitar surpresas
‚úÖ Ajustar CPU/RAM baseado em uso real (n√£o estimado)
```

### 2. Database
```
‚úÖ Usar Cloud SQL com inst√¢ncia adequada ao volume
‚úÖ Configurar connection pooling
‚úÖ Criar √≠ndices apenas necess√°rios
‚úÖ Monitorar performance de queries
‚úÖ Ajustar tamanho da inst√¢ncia conforme necessidade
‚úÖ Configurar backups autom√°ticos
```

### 3. Storage
```
‚úÖ Lifecycle policy autom√°tica (Standard ‚Üí Nearline ‚Üí Coldline)
‚úÖ Comprimir uploads antes de armazenar
‚úÖ Definir pol√≠tica de reten√ß√£o (ex: 7 anos documentos, 2 anos logs)
‚úÖ Deletar backups muito antigos
```

### 4. Monitoring
```
‚úÖ Usar free tier ao m√°ximo (50GB logs/m√™s)
‚úÖ Configurar sampling de logs (n√£o logar tudo)
‚úÖ Alertas apenas no essencial (evitar custo de notifica√ß√µes)
‚úÖ Usar Cloud Logging com reten√ß√£o curta (30 dias)
```

---

## üéØ Recomenda√ß√£o Final

### Para In√≠cio do Projeto (Entrega 1)

**Configura√ß√£o Recomendada: "Cloud SQL Standard"**

```yaml
Investimento mensal: R$ 479 (~$85.50)

Componentes:
  - Cloud Run Frontend (24/7): R$ 112
  - Cloud Run Backend (min-1): R$ 207
  - Cloud SQL PostgreSQL: R$ 112
  - Cloud Storage (backup): R$ 8
  - Monitoring: R$ 39

```

**Justificativa:**
1. ‚úÖ Custo acess√≠vel (~R$ 500/m√™s)
2. ‚úÖ Performance adequada para 3k cadastros/m√™s
3. ‚úÖ Disponibilidade 24/7 (link p√∫blico)
4. ‚úÖ Escal√°vel conforme crescimento
5. ‚úÖ ROI excelente (economia de R$ 24k/m√™s vs manual)

### Path de Evolu√ß√£o de Custos

```
Fase 1 (Entrega 1): R$ 479/m√™s
  ‚îî‚îÄ‚îÄ 3.000 cadastros/m√™s
  ‚îî‚îÄ‚îÄ Cloud SQL (1 vCPU, 3.75GB RAM)

Fase 2 (Crescimento): R$ 650/m√™s
  ‚îî‚îÄ‚îÄ 5.000-8.000 cadastros/m√™s
  ‚îî‚îÄ‚îÄ Upgrade Cloud SQL (2 vCPU, 7.5GB RAM)

Fase 3 (Escala): R$ 850/m√™s
  ‚îî‚îÄ‚îÄ 10.000+ cadastros/m√™s
  ‚îî‚îÄ‚îÄ Cloud SQL otimizado + Read replicas
  ‚îî‚îÄ‚îÄ Features avan√ßadas (Entrega 2 e 3)
```

---

## üìû Contato para D√∫vidas

**Quest√µes sobre custos ou otimiza√ß√µes:**
- Documenta√ß√£o GCP: https://cloud.google.com/pricing
- Calculadora de custos: https://cloud.google.com/products/calculator
- Suporte CodeBoa Software: [contato]

---

**√öltima atualiza√ß√£o:** Outubro 2025  
**Respons√°vel:** CodeBoa Software  
**Revis√£o:** Trimestral ou quando volume crescer 50%
